
{% load static %}
<link href='{%static "css/menu/mmenu.css"%}'rel="stylesheet">
<link href='{%static "css/menu/demo.css"%}'rel="stylesheet">

{% block content %}
<style>
            :root {
                --mm-sidebar-expanded-size: 300px;
            }
            .mm-menu {
                --mm-listitem-size: 50px;
                --mm-navbar-size: 50px;
            }

            @media (min-width: 992px) {
                .header a {
                    display: none;
                }
            }

            .mm-navbar_tabs span {
                display: inline-block;
                margin-left: 8px;
            }
            @media (max-width: 450px) {
                .mm-navbar_tabs span {
                    display: none;
                }
            }
        </style>
<div id="page">
            <div class="header">
                <a href="#menu"><span></span></a>
                Demo
            </div>
            <div class="content">
                <textarea readonly id="chat-log" cols="100" rows="20"></textarea><br/>
                <input id="chat-message-input" type="text" size="100"/><br/>
                <input id="chat-message-submit" type="button" value="Send"/>
            </div>
            <nav id="menu">
                <div id="panel-menu">
                    <ul>
                        <li><a href="#/">Home</a></li>
                        <li>
                            <span>About us</span>
                            <ul>
                                <li><a href="#/">History</a></li>
                                <li>
                                    <span>The team</span>
                                    <ul>
                                        <li><a href="#/">Management</a></li>
                                        <li><a href="#/">Sales</a></li>
                                        <li><a href="#/">Development</a></li>
                                    </ul>
                                </li>
                                <li><a href="#/">Our address</a></li>
                            </ul>
                        </li>
                        <li><a href="#/">Contact</a></li>

                        <li class="Divider">Other demos</li>
                        <li><a href="default.html">Default demo</a></li>
                        <li><a href="onepage.html">One page demo</a></li>
                    </ul>
                </div>

                <div id="panel-account">
                    <ul>
                        <li><a href="#/">My profile</a></li>
                        <li><a href="#/">Privacy settings</a></li>
                        <li><a href="#/">Activity</a></li>
                        <li><a href="#/">Sign out</a></li>
                    </ul>
                </div>

                <div id="panel-cart">
                    <p style="text-align: center; padding-top: 30px;">
                        Your shoppingcart is empty.<br />
                        <a href="#/">Continue shopping.</a>
                    </p>
                </div>
            </nav>
        </div>

{% endblock  %}
<script src='{%static "js/jquery-3.5.1.min.js"%}'></script>
<script src='{%static "js/menu/mmenu.js"%}'></script>

<script>
            new Mmenu(
                document.querySelector('#menu'),
                {
                    extensions: ['theme-dark', 'shadow-page'],
                    setSelected: true,
                    counters: true,
                    searchfield: {
                        placeholder: 'Search menu items',
                    },
                    iconbar: {
                        use: '(min-width: 450px)',
                        top: [
                            '<a href="#/"><span class="fa fa-home"></span></a>',
                        ],
                        bottom: [
                            '<a href="#/"><span class="fa fa-twitter"></span></a>',
                            '<a href="#/"><span class="fa fa-facebook"></span></a>',
                            '<a href="#/"><span class="fa fa-youtube"></span></a>',
                        ],
                    },
                    sidebar: {
                        collapsed: {
                            use: '(min-width: 450px)',
                            hideNavbar: false,
                        },
                        expanded: {
                            use: '(min-width: 992px)',
                        },
                    },
                    navbars: [
                        {
                            content: ['searchfield'],
                        },
                        {
                            type: 'tabs',
                            content: [
                                '<a href="#panel-menu"><i class="fa fa-bars"></i> <span>Menu</span></a>',
                                '<a href="#panel-account"><i class="fa fa-user"></i> <span>Account</span></a>',
                                '<a href="#panel-cart"><i class="fa fa-shopping-cart"></i> <span>Cart</span></a>',
                            ],
                        },
                        {
                            content: ['prev', 'breadcrumbs', 'close'],
                        },
                        {
                            position: 'bottom',
                            content: [
                                '<a href="http://mmenu.frebsite.nl/wordpress-plugin" target="_blank">WordPress plugin</a>',
                            ],
                        },
                    ],
                },
                {
                    searchfield: {
                        clear: true,
                    },
                    navbars: {
                        breadcrumbs: {
                            removeFirst: true,
                        },
                    },
                }
            );

            document.addEventListener('click', function (evnt) {
                var anchor = evnt.target.closest('a[href^="#/"]');
                if (anchor) {
                    alert("Thank you for clicking, but that's a demo link.");
                    evnt.preventDefault();
                }
            });
        </script>

<script>
    var name = '{{ name }}';
    var group_id='{{g_unit.id}}'
    // create new websocket url with name params
    {% comment %} var chatSocket = new WebSocket('ws://' + window.location.host +'/ws/group/chat/'+group_id+"/"); {% endcomment %}
    var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
    var websocket_str= ws_scheme+'://' + window.location.host + '/ws/group/chat/' + group_id + '/';
    var chatSocket = new WebSocket(websocket_str);
    // while get message append to textarea
    
    console.log(chatSocket)
    chatSocket.onmessage = function (e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        document.querySelector('#chat-log').value += (message + '\n');
        textarea.scrollTop = textarea.scrollHeight;
    };
    
    // while close print log
    chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function (e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#chat-message-submit').click();
        }
    };

    // click submit and send message to server by websocket
    document.querySelector('#chat-message-submit').onclick = function (e) {
        var messageInputDom = document.querySelector('#chat-message-input');
        var message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            'message': message
        }));

        messageInputDom.value = '';
    };
</script>